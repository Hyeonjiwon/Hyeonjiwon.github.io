---
title: '[Spring Boot] AOP' 
excerpt: 'ìŠ¤í”„ë§ ì…ë¬¸ - AOP'
categories:
    - Spring Boot

tag:
    - Spring Boot 
    - JAVA

author_profile: true    #ì‘ì„±ì í”„ë¡œí•„ ì¶œë ¥ ì—¬ë¶€

last_modified_at: 2022-04-14T15:00:00+09:00

toc: true   #Table Of Contents ëª©ì°¨ 

toc_sticky: true
---


## AOPê°€ í•„ìš”í•œ ìƒí™©

âœ… ëª¨ë“  ë©”ì†Œë“œì˜ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ë‹¤ë©´? 

âœ… ê³µí†µ ê´€ì‹¬ ì‚¬í•­(cross-cutting concern) vs í•µì‹¬ ê´€ì‹¬ ì‚¬í•­(core concern)

âœ… íšŒì› ê°€ì… ì‹œê°„, íšŒì› ì¡°íšŒ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ë‹¤ë©´?

![image](https://user-images.githubusercontent.com/47733530/163323661-c8db2c25-3ca9-44b2-a6d4-101c1c4c65f4.png)

<br>

**service/MemberService.java**ì— **MemberService íšŒì› ì¡°íšŒ ì‹œê°„ ì¸¡ì •**ì„ ì¶”ê°€

join ë©”ì†Œë“œì˜ ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •

```java
public Long join(Member member) {

    long start = System.currentTimeMillis(); // millisecondë¡œ ë°›ì„ ìˆ˜ ìˆìŒ

    // ë¡œì§ì´ ëë‚  ë•Œ ì‹œê°„ì„ ì°ì–´ì•¼ í•¨
    try {
        validateDuplicateMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    } finally { // ì˜ˆì™¸ê°€ ìƒê²¨ë„ ì‹œê°„ ì¶œë ¥
        long finish = System.currentTimeMillis();
        long timeMs = finish - start;
        System.out.println("join = " + timeMs + "ms");
    }
}
```

í…ŒìŠ¤íŠ¸ë¥¼ ëŒë ¤ë³´ì 

<img width="922" alt="Screen Shot 2022-04-14 at 3 21 56 PM" src="https://user-images.githubusercontent.com/47733530/163325856-788ff161-6cb0-4dbb-b37d-e1a0cf81a69d.png">

<img width="921" alt="Screen Shot 2022-04-14 at 3 22 07 PM" src="https://user-images.githubusercontent.com/47733530/163325871-cf7f9279-f155-41f2-a6a1-70309446d551.png">

<br>

íšŒì› ì¡°íšŒ ë©”ì†Œë“œì—ë„ ì‹œê°„ ì¸¡ì • ì½”ë“œ ì¶”ê°€

```java
public List<Member> findMembers() {
    long start = System.currentTimeMillis();

    try {
        return memberRepository.findAll();
    } finally {
        long finish = System.currentTimeMillis();
        long timeMs = finish - start;
        System.out.println("findMembers = " + timeMs + "ms");
    }
}
```

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ì‹œê°„ì´ ì¶œë ¥ ë˜ëŠ”ì§€ í™•ì¸

<img width="873" alt="Screen Shot 2022-04-14 at 3 26 40 PM" src="https://user-images.githubusercontent.com/47733530/163326515-bcb96318-0ccf-4372-b100-84a460fbec40.png">

<img width="936" alt="Screen Shot 2022-04-14 at 3 27 07 PM" src="https://user-images.githubusercontent.com/47733530/163326576-e98f7ff7-df0c-491b-a845-10785f6dba52.png">

â¬†ï¸ ì²˜ìŒ ëŒë¦´ë• ì˜¤ë˜ê±¸ë¦¬ê³ , ë‘ë²ˆì§¸ ì‹¤í–‰í•  ë• ì‹œê°„ì´ ì¤„ì–´ë“ ë‹¤. 

ë“±ë¡ë„ í•´ë´¤ë‹¤.

<img width="939" alt="Screen Shot 2022-04-14 at 3 30 24 PM" src="https://user-images.githubusercontent.com/47733530/163327026-163eb402-5e67-4233-a522-478eab82474a.png">

<br>

â—ï¸**ë¬¸ì œ**
- íšŒì›ê°€ì…, íšŒì› ì¡°íšŒì— **ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ê¸°ëŠ¥**ì€ **í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ì´ ì•„ë‹ˆë‹¤.**
- ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë¡œì§ì€ **ê³µí†µ ê´€ì‹¬ ì‚¬í•­**ì´ë‹¤.
- ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë¡œì§ê³¼ í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ì˜ **ë¡œì§ì´ ì„ì—¬ì„œ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë µë‹¤.**
- ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¤ê¸° ë§¤ìš° ì–´ë µë‹¤. 
- ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë¡œì§ì„ ë³€ê²½í•  ë•Œ ëª¨ë“  ë¡œì§ì„ ì°¾ì•„ê°€ë©´ì„œ ë³€ê²½í•´ì•¼ í•œë‹¤. 


## AOP ì ìš©

> **AOP** : Aspect Oriented Programming, ê´€ì ì§€í–¥ í”„ë¡œê·¸ë˜ë°
> **ê³µí†µ ê´€ì‹¬ ì‚¬í•­**(Cross-cutting concern) vs **í•µì‹¬ ê´€ì‹¬ ì‚¬í•­**(core concern) ë¶„ë¦¬

ìœ„ì—ì„œëŠ” ì‹œê°„ì¸¡ì • ë¡œì§ë“¤ì„ ë©”ì†Œë“œì— ë‹¤ ë¶™ì˜€ë‹¤. â¡ï¸ ì´ì   AOPë¡œ ì‹œê°„ ì¸¡ì • ë¡œì§ì„ í•œ ê³³ì— ëª¨ìœ¼ê³  ì›í•˜ëŠ”ë° ì ìš©

![image](https://user-images.githubusercontent.com/47733530/163327759-ac65c70c-0eb6-422d-ab5b-63751ceebb80.png)

**ì‹œê°„ ì¸¡ì • AOP ë“±ë¡**

**src/main/java/com.example.memberproject/aop** íŒ¨í‚¤ì§€ ìƒì„± í›„,**TimeTraceAop.java** ì‘ì„±

 ```java
 package com.example.memberproject.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.springframework.stereotype.Component;

@Aspect
@Component // ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ìœ¼ë¡œ ë“±ë¡í•´ë„ ë¨
// ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ë³´ë‹¤ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•´ì„œ ì“°ëŠ”ê²ƒì„ ë” ì„ í˜¸ -> SpringConfigì—ì„œ ë“±ë¡
public class TimeTraceAop { // ì´ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤˜ì•¼ í•¨

    @Around("execution(* com.example.memberproject..*(..))") // ì–´ë–¤ ë©”ì†Œë“œì— ì ìš©í•  ê²ƒì¸ì§€ íƒ€ê²ŸíŒ…í•  ìˆ˜ ìˆìŒ
    public Object execut(ProceedingJoinPoint joinPoint) throws Throwable {
        // ì‹œê°„ ë¡œì§
        long start = System.currentTimeMillis();
        System.out.println("STRAT: " + joinPoint.toString()); // ì–´ë–¤ ë©”ì†Œë“œë¥¼ call í•˜ëŠ”ì§€ ì´ë¦„ì„ ì–»ì–´ì˜¬  ìˆ˜ ìˆìŒ
        try {
            // ë‹¤ìŒ ë©”ì†Œë“œë¡œ ì§„í–‰
            // Object result = joinPoint.proceed();// ë‹¤ìŒ ë©”ì†Œë“œë¡œ ì§„í–‰
            // return result;
            return joinPoint.proceed(); // ì¸ë¼ì¸ìœ¼ë¡œ ë³€ê²½

        } finally {
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("END: " + joinPoint.toString() + " " + timeMs + "ms");
        }
    }
}
 ```

ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì 

<img width="884" alt="Screen Shot 2022-04-14 at 3 56 40 PM" src="https://user-images.githubusercontent.com/47733530/163330826-d7b4dbc8-ff60-4f6d-92c4-6ef6b5aea620.png">

ì˜ ì¶œë ¥ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. 

<br>

> **MemberService.java** ì—ì„œ ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ì§€ìš°ê³  ì›ë˜ëŒ€ë¡œ ëŒë ¤ë†“ê¸° ! 

<img width="938" alt="Screen Shot 2022-04-14 at 3 59 47 PM" src="https://user-images.githubusercontent.com/47733530/163331311-36688a5b-7d5d-45d0-abe8-d1c9cf517671.png">

<br>

> í˜¸ì¶œì´ ë  ë•Œë§ˆë‹¤ joinPointì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•´ì„œ ì¡°ì‘í•  ìˆ˜ ìˆë‹¤. 
> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ì¸í„°ì…‰íŠ¸ê°€ ê±¸ë¦¬ëŠ” ê²ƒ

<br>

**í•´ê²°**
- íšŒì›ê°€ì…, íšŒì› ì¡°íšŒ ë“± í•µì‹¬ ê´€ì‹¬ì‚¬í•­ê³¼ ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ê³µí†µ ê´€ì‹¬ ì‚¬í•­ì„ ë¶„ë¦¬í•œë‹¤. 
- ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤. 
- í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ì„ ê¹”ë”í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤. 
- ë³€ê²½ì´ í•„ìš”í•˜ë©´ ì´ ë¡œì§ë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤. 
- ì›í•˜ëŠ” ì ìš© ëŒ€ìƒì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤. 

## ìŠ¤í”„ë§ AOP ë™ì‘ ë°©ì‹ ì„¤ëª…

**AOP ì ìš© ì „ ì˜ì¡´ê´€ê³„**

<img width="611" alt="Screen Shot 2022-04-14 at 4 12 56 PM" src="https://user-images.githubusercontent.com/47733530/163333273-445874e5-6d60-4566-8a6b-60aff2bd1a9e.png">

â¡ï¸ helloControllerê°€ memberServiceì— ì˜ì¡´í•˜ê³  ìˆê³ , helloControllerì—ì„œ memberServiceì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œ 

â¡ï¸ ì˜ì¡´ê´€ê³„ê°€ ìˆê³  ê·¸ëƒ¥ í˜¸ì¶œí–ˆë‹¤.  

<br>

**AOP ì ìš© í›„ ì˜ì¡´ê´€ê³„**

<img width="605" alt="Screen Shot 2022-04-14 at 4 13 35 PM" src="https://user-images.githubusercontent.com/47733530/163333381-8d62a1fd-2cf1-4760-b07e-b24d2eed0743.png">

â¡ï¸ AOPê°€ ìˆìœ¼ë©´ ìŠ¤í”„ë§ì€ ê°€ì§œ memberServiceë¥¼ ë§Œë“ ë‹¤. = í”„ë¡ì‹œ

â¡ï¸ ìŠ¤í”„ë§ì´ ì˜¬ë¼ì˜¬ ë•Œ, ì»¨í…Œì´ë„ˆì— ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•  ë•Œ, ì§„ì§œ ìŠ¤í”„ë§ ë¹ˆì´ ì•„ë‹ˆë¼ ê°€ì§œ ìŠ¤í”„ë§ ë¹ˆì„ ì•ì— ì„¸ì›Œ ë†“ëŠ”ë‹¤.

â¡ï¸ ê°€ì§œ ìŠ¤í”„ë§ ë¹ˆì´ ëë‚˜ë©´, joinPoint.proceed() í•˜ë©´ ë‚´ë¶€ì ìœ¼ë¡œ íƒ€ê³ , ê·¸ë•Œ ì‹¤ì œ memberServiceë¥¼ ì§„ì§œë¡œ í˜¸ì¶œ

â¡ï¸ helloControllerê°€ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ì§„ì§œ memberServiceê°€ ì•„ë‹Œ í”„ë¡ì‹œë¼ëŠ” ê¸°ìˆ ë¡œ ë°œìƒí•˜ëŠ” ê°€ì§œ memberServiceì´ë‹¤.

**ì‹¤ì œ Proxyê°€ ì£¼ì…ë˜ëŠ”ì§€ ì½˜ì†”ì— ì¶œë ¥í•´ë³´ê¸°**

â¬‡ï¸ MemberController.javaì˜ ìƒì„±ìì—ì„œ ì°ì–´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¨ë‹¤. 

```
memberService = class com.example.memberproject.service.MemberService$$EnhancerBySpringCGLIB$$7ca48fe3
```
ë³´ë©´ memberServiceë¡œ ëë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ $$EnhancerBySpringCGLIB$$7ca48fe3 ì´ëŸ°ê²Œ ë¶™ì–´ì„œ ë‚˜ì˜¨ë‹¤. EnhancerBySpringCGLIBëŠ” MemberServiceë¥¼ ë³µì œë¥¼ í•´ì„œ ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ê¸°ìˆ ì´ë‹¤. 

<br>

**AOP ì ìš© ì „ ì „ì²´ ê·¸ë¦¼**

<img width="607" alt="Screen Shot 2022-04-14 at 4 27 26 PM" src="https://user-images.githubusercontent.com/47733530/163335533-1b3d9e06-eba3-4e14-ab3a-df023d55fc80.png">

<br>

**AOP ì ìš© í›„ ì „ì²´ ê·¸ë¦¼**

<img width="606" alt="Screen Shot 2022-04-14 at 4 27 51 PM" src="https://user-images.githubusercontent.com/47733530/163335614-c7ade5fd-fc17-4752-8b6c-29f447916d89.png">



## ì •ë¦¬

> H2 ë°ì´í„° ë² ì´ìŠ¤ : ì‹¤ë¬´ì—ì„œ ë¡œì»¬ dbë¡œ ë§ì´ ì“´ë‹¤. 
> ì‹¤ì œ ìš´ì˜ì€ mysql ê³„ì—´, jpa ë¥¼ ì“°ë©´ ì´ëŸ°ê±¸ ë°”ê¿”ì¹˜ê¸°í•  ìˆ˜ ìˆê¸° ë•Œë¬¸
> jpaê°€ ì¿¼ë¦¬ë¥¼ dbì— ë§ì¶°ì„œ sqlì„ ë§Œë“¤ì–´ì¤€ë‹¤. 

<hr>

ìŠ¤í”„ë§ì„ ì–´ë–»ê²Œ ì‹œì‘í•´ì•¼ í•˜ëŠ”ì§€ ë§‰ë§‰í–ˆì—ˆëŠ”ë°, 
ì¢‹ì€ ë¬´ë£Œ ê°•ì˜ì™€ ìœ¤ê²½ë‹˜ì˜ ì˜ ì •ë¦¬ëœ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ë©´ì„œ ê³µë¶€í•  ìˆ˜ ìˆì—ˆë‹¤ ã…ã…...
ì—„ì²­ ê±°ëŒ€í•œ ìŠ¤í”„ë§... ì•„ì§ ë§ì´ ëª¨ë¥´ì§€ë§Œ,,, ì—´ì‹¬íˆ í•´ë³´ì..!! 


ğŸŸ¢ ìŠ¤í”„ë§ì˜ íë¦„ì„ íŒŒì•…í•˜ì â¡ï¸ ì „ë°˜ì ì¸ ì§€ë„ ê·¸ë¦¬ê¸° 

ğŸŸ¢ ê°ê°ì˜ ê¸°ìˆ ë“¤ì„ ê¹Šì´ìˆê²Œ ì´í•´í•˜ì

ğŸŸ¢ ìŠ¤í”„ë§ì„ í™œìš©í•´ì„œ ì‹¤ë¬´ì—ì„œ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤ì„ ì˜ í•´ê²°í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ì¤‘ìš”

ğŸŸ¢ í•µì‹¬ ì›ë¦¬ë¥¼ ì´í•´í•˜ê³ , ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ, ëŒ€ëµ ì–´ë””ì¯¤ ë¶€í„° ì°¾ì•„ë“¤ì–´ê°€ë©´ ë ì§€, í•„ìš”í•œ ë¶€ë¶„ì„ ì°¾ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥!!



## ì°¸ê³ 

> [ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ ](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/lecture/49601?tab=note&volume=0.80&mm=close)

> [YoonkyungH.log](https://velog.io/@dbsrud11/Spring-Boot-7-AOP)