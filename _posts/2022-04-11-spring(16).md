---
title: '[Spring Boot] H2 데이터베이스 설치 2' 
excerpt: '스프링 입문 - 스프링 DB 접근 기술'
categories:
    - Spring Boot

tag:
    - Spring Boot 
    - JAVA

author_profile: true    #작성자 프로필 출력 여부

last_modified_at: 2022-04-1T20:00:00+09:00

toc: true   #Table Of Contents 목차 

toc_sticky: true
---


## 스프링 통합 테스트

이전에 했던 테스트는 순수한 java 코드를 한 것, 스프링과 아무 관련이 없는 테스트

스프링과 테스트를 엮어서 해보자

**test/java/com.example.memberproject/service**에 
**MemberServiceTest.java**를 복사 붙여넣기, 이름을 **MemberServiceIntegrationTest**로 수정해 파일 생성 후 코드 수정

- 이제는 스프링 컨테이너한테 멤버서비스 멤버리퍼지토리 내놔 해야함
- 테스트는 반복 할 수 있어야 한다.
  
```java
package com.example.memberproject.service;

import com.example.memberproject.domain.Member;
import com.example.memberproject.repository.MemberRepository;
import com.example.memberproject.repository.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;

@SpringBootTest
@Transactional // test를 실행할 때, transaction을 먼저 실행하고 db에 데이터를 넣은 다음 rollback을 해줌, 그래서 db에 넣었던 데이터가 깔끔하게 지워짐
class MemberServiceIntegrationTest {

    @Autowired MemberService memberService;
    @Autowired MemberRepository memberRepository;

    @Test
    void 회원가입() {
        // given
        Member member = new Member();
        member.setName("spring");

        // when
        Long saveId = memberService.join(member);

        // then
        Member findmember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findmember.getName());
    }

    @Test
    public void 중복_회원_예외() {
        // given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        // when
        memberService.join(member1);
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));

        assertThat(e.getMessage()).isEqualTo("이미 존재하는 회원입니다.");
    }
}
```

✔️ **@SpringBootTest** : 스프링 컨테이너와 테스트를 함께 실행
✔️ **@Transactional** : 테스트 케이스에 이 에노테이션이 있으면, 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 **rollback** 한다. (테스트 하나하나 마다) 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다. 테스트 케이스에 붙었을 때만 이렇게 동작

> (참고) : 순수한 단위 테스트(java 코드로 최소한의 단위만 하는 것)가 훨씬 좋은 테스트일 확률이 높음
> 단위단위로 테스트를 잘 쪼개서 할 수 있도록 하고, 스프링 컨테이너 없이 테스트할 수 있도록 훈련해야 함
> 컨테이너까지 올려야 하는 상황이면 테스트 설계가 잘못됐을 확률이 높음


## 스프링 JdbcTemplate
- 순수 Jdbc와 동일한 환경설정을 하면 된다.  
- 스프링 JdbcTemplate과 MyBatis 같은 라이브러리는 JDBC API에서 본인의

## JPA

## 스프링 데이터 JPA 

## 참고

> [스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/lecture/49593?tab=curriculum&volume=0.90&mm=close)

> [YoonkyungH.log](https://velog.io/@dbsrud11/Spring-Boot-61-%EC%8A%A4%ED%94%84%EB%A7%81-DB-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0)