---
title: '[Spring Boot] H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜ 2' 
excerpt: 'ìŠ¤í”„ë§ ì…ë¬¸ - ìŠ¤í”„ë§ DB ì ‘ê·¼ ê¸°ìˆ '
categories:
    - Spring Boot

tag:
    - Spring Boot 
    - JAVA

author_profile: true    #ì‘ì„±ì í”„ë¡œí•„ ì¶œë ¥ ì—¬ë¶€

last_modified_at: 2022-04-12T20:00:00+09:00

toc: true   #Table Of Contents ëª©ì°¨ 

toc_sticky: true
---


## ìŠ¤í”„ë§ í†µí•© í…ŒìŠ¤íŠ¸

ì´ì „ì— í–ˆë˜ í…ŒìŠ¤íŠ¸ëŠ” ìˆœìˆ˜í•œ java ì½”ë“œë¥¼ í•œ ê²ƒ, ìŠ¤í”„ë§ê³¼ ì•„ë¬´ ê´€ë ¨ì´ ì—†ëŠ” í…ŒìŠ¤íŠ¸

ìŠ¤í”„ë§ê³¼ í…ŒìŠ¤íŠ¸ë¥¼ ì—®ì–´ì„œ í•´ë³´ì

**test/java/com.example.memberproject/service**ì— 
**MemberServiceTest.java**ë¥¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°, ì´ë¦„ì„ **MemberServiceIntegrationTest**ë¡œ ìˆ˜ì •í•´ íŒŒì¼ ìƒì„± í›„ ì½”ë“œ ìˆ˜ì •

- ì´ì œëŠ” ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆí•œí…Œ ë©¤ë²„ì„œë¹„ìŠ¤ ë©¤ë²„ë¦¬í¼ì§€í† ë¦¬ ë‚´ë†” í•´ì•¼í•¨
- 
- í…ŒìŠ¤íŠ¸ëŠ” ë°˜ë³µ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
  
```java
package com.example.memberproject.service;

import com.example.memberproject.domain.Member;
import com.example.memberproject.repository.MemberRepository;
import com.example.memberproject.repository.MemoryMemberRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.transaction.annotation.Transactional;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertThrows;

@SpringBootTest
@Transactional // testë¥¼ ì‹¤í–‰í•  ë•Œ, transactionì„ ë¨¼ì € ì‹¤í–‰í•˜ê³  dbì— ë°ì´í„°ë¥¼ ë„£ì€ ë‹¤ìŒ rollbackì„ í•´ì¤Œ, ê·¸ë˜ì„œ dbì— ë„£ì—ˆë˜ ë°ì´í„°ê°€ ê¹”ë”í•˜ê²Œ ì§€ì›Œì§
class MemberServiceIntegrationTest {

    @Autowired MemberService memberService;
    @Autowired MemberRepository memberRepository;

    @Test
    void íšŒì›ê°€ì…() {
        // given
        Member member = new Member();
        member.setName("spring");

        // when
        Long saveId = memberService.join(member);

        // then
        Member findmember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findmember.getName());
    }

    @Test
    public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() {
        // given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        // when
        memberService.join(member1);
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));

        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }
}
```

âœ”ï¸ **@SpringBootTest** : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì™€ í…ŒìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ì‹¤í–‰

âœ”ï¸ **@Transactional** : í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— ì´ ì—ë…¸í…Œì´ì…˜ì´ ìˆìœ¼ë©´, í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ì— íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ì— í•­ìƒ **rollback** í•œë‹¤. (í…ŒìŠ¤íŠ¸ í•˜ë‚˜í•˜ë‚˜ ë§ˆë‹¤) ì´ë ‡ê²Œ í•˜ë©´ DBì— ë°ì´í„°ê°€ ë‚¨ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì— ë¶™ì—ˆì„ ë•Œë§Œ ì´ë ‡ê²Œ ë™ì‘


> (ì°¸ê³ ) : ìˆœìˆ˜í•œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(java ì½”ë“œë¡œ ìµœì†Œí•œì˜ ë‹¨ìœ„ë§Œ í•˜ëŠ” ê²ƒ)ê°€ í›¨ì”¬ ì¢‹ì€ í…ŒìŠ¤íŠ¸ì¼ í™•ë¥ ì´ ë†’ìŒ
> ë‹¨ìœ„ë‹¨ìœ„ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì˜ ìª¼ê°œì„œ í•  ìˆ˜ ìˆë„ë¡ í•˜ê³ , ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ì—†ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ í›ˆë ¨í•´ì•¼ í•¨
> ì»¨í…Œì´ë„ˆê¹Œì§€ ì˜¬ë ¤ì•¼ í•˜ëŠ” ìƒí™©ì´ë©´ í…ŒìŠ¤íŠ¸ ì„¤ê³„ê°€ ì˜ëª»ëì„ í™•ë¥ ì´ ë†’ìŒ


## ìŠ¤í”„ë§ JdbcTemplate

- ìˆœìˆ˜ Jdbcì™€ ë™ì¼í•œ í™˜ê²½ì„¤ì •ì„ í•˜ë©´ ëœë‹¤.  
  
- ìŠ¤í”„ë§ JdbcTemplateê³¼ MyBatis ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” JDBC APIì—ì„œ ë³¸ ë°˜ë³µ ì½”ë“œë¥¼ ëŒ€ë¶€ë¶„ ì œê±°í•´ì¤Œ. í•˜ì§€ë§Œ SQLì€ ì§ì ‘ ì‘ì„±í•´ì•¼ í•¨

â¡ï¸ **JdbcTemplateëŠ” ì‹¤ë¬´ì—ì„œë„ ë§ì´ ì”€**

**src/main/com.example.memberproject/repository**ì—  **JdbcTemplateMemberRepository.java** ìƒì„± í›„ ì½”ë“œ ì‘ì„±

MemberRepositoryë¥¼ implements í•œ í›„, option + enterë¡œ êµ¬í˜„ ë©”ì†Œë“œ ì¬ì •ì˜

```java
public class JdbcTemplateMemberRepository implements MemberRepository{

    private final JdbcTemplate jdbcTemplate;

    // @Autowired
    public JdbcTemplateMemberRepository(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }
```

â— ìƒì„±ìê°€ í•˜ë‚˜ë§Œ ìˆìœ¼ë©´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ @Autowired ìƒëµ ê°€ëŠ¥, ìë™ìœ¼ë¡œ dataSource ë¥¼ injection 

findById ë©”ì†Œë“œ ì‘ì„±

```java
@Override
public Optional<Member> findById(Long id) {
    List<Member> result = jdbcTemplate.query("select * from where id = ?", memberRowMapper());
    return result.stream().findAny();
}
```

memberRowMapper ë©”ì†Œë“œ ì‘ì„±

```java
private RowMapper<Member> memberRowMapper() {
        return new RowMapper<Member>() { // 
            @Override
            public Member mapRow(ResultSet rs, int rowNum) throws SQLException {
                Member member = new Member();
                member.setId(rs.getLong("id"));
                member.setName(rs.getString("name"));

                return member;
            }
        }
    }
```

option + enter ë¡œ í•´ì„œ ëŒë‹¤ë¡œ ë°”ê¾¸ê¸°

```java
private RowMapper<Member> memberRowMapper() {
    //
    return (rs, rowNum) -> {
        Member member = new Member();
        member.setId(rs.getLong("id"));
        member.setName(rs.getString("name"));

        return member;
    };
}
```

<br>

**JdbcTemplateMemberRepository ì „ì²´ ì½”ë“œ**

```java
package com.example.memberproject.repository;

import com.example.memberproject.domain.Member;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;

import javax.sql.DataSource;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Optional;

public class JdbcTemplateMemberRepository implements MemberRepository{

    private final JdbcTemplate jdbcTemplate;

    // @Autowired // ìƒì„±ìê°€ í•˜ë‚˜ë©´ ìƒëµ ê°€ëŠ¥
    public JdbcTemplateMemberRepository(DataSource dataSource) {
        jdbcTemplate = new JdbcTemplate(dataSource);
    }

    @Override
    public Member save(Member member) {
        SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(jdbcTemplate);
        jdbcInsert.withTableName("member").usingGeneratedKeyColumns("id");

        Map<String, Object> parameters = new HashMap<>();
        parameters.put("name", member.getName());

        Number key = jdbcInsert.executeAndReturnKey(new MapSqlParameterSource(parameters));
        member.setId(key.longValue());

        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        List<Member> result = jdbcTemplate.query("select * from member where id = ?", memberRowMapper(), id);
        return result.stream().findAny();
    }

    @Override
    public Optional<Member> findByName(String name) {
        List<Member> result = jdbcTemplate.query("select * from member where name = ?", memberRowMapper(), name);
        return result.stream().findAny();
    }

    @Override
    public List<Member> findAll() {
        return jdbcTemplate.query("select * from member", memberRowMapper());
    }

    private RowMapper<Member> memberRowMapper() {
        return (rs, rowNum) -> {
            Member member = new Member();
            member.setId(rs.getLong("id"));
            member.setName(rs.getString("name"));

            return member;
        };
    }
}
```

â•(ì½”ë“œ í•´ì„í•´ì„œ ì •ë¦¬í•˜ê¸°)

**SpringConfig.java**ì˜ memberRepository() ìˆ˜ì •

```java
@Bean
public MemberRepository memberRepository() {
    // return new MemoryMemberRepository();
    // return new JdbcMemberRepository(dataSource);
    return new JdbcTemplateMemberRepository(dataSource);
}
```

TEST ë¥¼ í•´ë³´ì 
MemberServiceIntegrationTest ë¥¼ ì‹¤í–‰ì‹œì¼œ ë³¸ ê²°ê³¼ ëª¨ë‘ ì˜ í†µê³¼í•œë‹¤. 

<img width="990" alt="Screen Shot 2022-04-12 at 5 13 45 PM" src="https://user-images.githubusercontent.com/47733530/162913580-fd91d5ea-a215-418b-af7b-d93c2d64db13.png">



## JPA

- JPAëŠ” ê¸°ì¡´ì˜ ë°˜ë³µ ì½”ë“œëŠ” ë¬¼ë¡ ì´ê³ , **ê¸°ë³¸ì ì¸ SQLë„ JPAê°€ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì‹¤í–‰**í•´ì¤€ë‹¤. 
- JPAë¥¼ ì‚¬ìš©í•˜ë©´, SQLê³¼ ë°ì´í„° ì¤‘ì‹¬ì˜ ì„¤ê³„ì—ì„œ **ê°ì²´ ì¤‘ì‹¬ì˜ ì„¤ê³„**ë¡œ íŒ¨ëŸ¬ë‹¤ì„ì„ ì „í™˜í•  ìˆ˜ ìˆë‹¤.
- JPAë¥¼ ì‚¬ìš©í•˜ë©´ **ê°œë°œ ìƒì‚°ì„±ì„ í¬ê²Œ ë†’ì¼ ìˆ˜ ìˆë‹¤.** 
  

**build.gradle íŒŒì¼ì— JPA, h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€**

```java
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	// implementation 'org.springframework.boot:spring-boot-starter-jdbc'
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	runtimeOnly 'com.h2database:h2'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```

â¡ï¸ spring-boot-starter-data-jpaëŠ” ë‚´ë¶€ì— jdbc ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•œë‹¤. ë”°ë¼ì„œ jdbcëŠ” ì œê±°í•´ë„ ëœë‹¤. 

<br>

**ìŠ¤í”„ë§ ë¶€íŠ¸ì— JPA ì„¤ì • ì¶”ê°€**

**resources/appication.properties**ì— ì•„ë˜ ë‘ì¤„ ì¶”ê°€

```java
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.jpa.show.sql=true
spring.jpa.hibernate.ddl-auto=none
```

- **show-sql** : JPAê°€ ìƒì„±í•˜ëŠ” SQLì„ ì¶œë ¥í•œë‹¤.
- **ddl-auto** : JPAëŠ” í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë°, noneì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ ëˆë‹¤. 
  - **create** ë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í…Œì´ë¸”ë„ ì§ì ‘ ìƒì„±í•´ì¤€ë‹¤ â¡ï¸ í•´ë³´ê¸°

JPAëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ ì œê³µ, ê°ì²´ë‘ ORMì´ë¼ëŠ” ê¸°ìˆ , êµ¬í˜„ì²´ë¡œ hibernateë¡œ êµ¬í˜„, 

âœ”ï¸ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ dbì™€ ë§¤í•‘!

1. ì—”í‹°í‹°ë‘ ë§¤í•‘ì„ í•´ì•¼í•¨ â¡ï¸ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ @Entitiy
2. pk ë§¤í•‘ â¡ï¸ @Id

**domain/Member.java**

```java
package com.example.memberproject.domain;

import javax.persistence.*;

@Entity
public class Member {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id; // ë°ì´í„° êµ¬ë¶„ì„ ìœ„í•´ systemì´ ì €ì¥í•˜ëŠ” id

    // @Column(name = "username") // dbì— columnëª…ì´ usernameì¼ ê²½ìš° ì´ë ‡ê²Œ í•´ì£¼ë©´ mapping
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

> **@Entity** : MemberëŠ” JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ë‹¤.
> **@GeneratedValue(strategy = GenerationType.IDENTITY)** : dbì—ì„œ ìë™ìœ¼ë¡œ Idë¥¼ ìƒì„±í•´ ì£¼ëŠ” ê²ƒ (= identity)

<br>

**repository/JpaMemberRepository.java** ìƒì„±

â—ï¸ **JPAë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ EntityManagerë¥¼ ì£¼ì…** ë°›ì•„ì•¼ í•œë‹¤. 
> gradle íŒŒì¼ì—ì„œ jpa ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°›ì•˜ìœ¼ë¯€ë¡œ(implementation) ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ìë™ìœ¼ë¡œ í˜„ì¬ dbì™€ ì—°ê²°í•´ì„œ EntityManagerë¥¼ ìƒì„±í•´ ì¤€ë‹¤. ë§Œë“¤ì–´ì§„ ê²ƒì„ injection ë°›ìœ¼ë©´ ëœë‹¤.

```java
package com.example.memberproject.repository;

import com.example.memberproject.domain.Member;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityManager;
import java.util.List;
import java.util.Optional;

public class JpaMemberRepository implements MemberRepository {

    private final EntityManager em; // jpaëŠ” EntityManagerë¡œ ëª¨ë“ ê²Œ ë™ì‘

    public JpaMemberRepository(EntityManager em) { // ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ìë™ìœ¼ë¡œ EntityManager ìƒì„±, ë§Œë“¤ì–´ ì§„ ê²ƒì„ ê·¸ëƒ¥ injection ë°›ìœ¼ë©´ ëœë‹¤
        this.em = em;
    }

    @Override
    public Member save(Member member) {
        em.persist(member); // persist ì˜ì†í•˜ë‹¤, ì˜êµ¬ì €ì¥í•˜ë‹¤
        return member; // jpaê°€ insert ì¿¼ë¦¬ ë‹¤ ë§Œë“¤ì–´ì„œ dbì— ì§‘ì–´ë„£ê³ , setIdê¹Œì§€ í•´ì¤Œ
    }

    @Override
    public Optional<Member> findById(Long id) {
        Member member = em.find(Member.class, id); // ì¡°íšŒí•  íƒ€ì…, pk
        return Optional.ofNullable(member);
    }

    @Override
    public Optional<Member> findByName(String name) {
        List<Member> result = em.createQuery("select m from Member m where m.name = :name", Member.class) // jpql : ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´
                .setParameter("name", name)
                .getResultList();

        return result.stream().findAny();
    }

    @Override
    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class) // ê°ì²´ ìì²´ë¥¼ select
                .getResultList(); // jpql : ê°ì²´(entity)ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¼, ê·¸ëŸ¼ sqlë¡œ ë²ˆì—­
    }
}
```

> ë‹¨ì¶•í‚¤ : command + option + N : ì¸ë¼ì¸ìœ¼ë¡œ ë°”ê¿”ì¤Œ
> ë‹¨ì¶•í‚¤ : control + T : ê²€ìƒ‰


â—ï¸ ì£¼ì˜ : jpaë¥¼ ì“°ë ¤ë©´ í•­ìƒ transactionì´ ìˆì–´ì•¼ í•¨ â¡ï¸ **@Transatcional** (ë°ì´í„° ë³€ê²½, ì €ì¥í•  ë•Œ í•„ìš”)

**MemberService.java**ì— **@Transactional** ì¶”ê°€

```java
import org.springframework.transaction.annotation.Transactional;

@Transactional
public class MemberService {
    ...
}
```

- ìŠ¤í”„ë§ì€ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•  ë•Œ transaction ì‹œì‘, ë©”ì†Œë“œê°€ ì •ìƒ ì¢…ë£Œë˜ë©´ transactionì„ commit. ë§Œì•½ ëŸ°íƒ€ì„ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ rollback
  
- JPAë¥¼ í†µí•œ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ transaction ì•ˆì—ì„œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.

<br>

JPAë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½

**SpringConfig.java** ìˆ˜ì •

```java
package com.example.memberproject;

import com.example.memberproject.repository.*;
import com.example.memberproject.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;
import javax.sql.DataSource;

@Configuration
public class SpringConfig {

    private EntityManager em;

    @Autowired
    public SpringConfig(EntityManager em) {
        this.em = em;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        // return new MemoryMemberRepository();
        // return new JdbcMemberRepository(dataSource);
        // return new JdbcTemplateMemberRepository(dataSource);
        return new JpaMemberRepository(em);
    }
}
```

<br>

**TEST**

íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸ í•´ë³´ê¸° 

<img width="1032" alt="Screen Shot 2022-04-12 at 6 56 43 PM" src="https://user-images.githubusercontent.com/47733530/162934119-cdb9918f-3a5e-46d4-b3ac-5edf12acbac4.png">

> **@Commit**ì„ ì¶”ê°€í•˜ë©´ dbì— ì €ì¥ëœë‹¤.

<img width="885" alt="Screen Shot 2022-04-12 at 7 00 20 PM" src="https://user-images.githubusercontent.com/47733530/162934799-e27af483-5d10-4137-88c6-e798ae5a3b60.png">

(í•˜ê³  ë°ì´í„° ë‹¤ ì§€ìš°ê¸° : delete from member;)

ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•´ë³´ì

<img width="891" alt="Screen Shot 2022-04-12 at 7 01 51 PM" src="https://user-images.githubusercontent.com/47733530/162935083-9417a333-09d5-463b-946c-ccb9e4981bd5.png">



## ìŠ¤í”„ë§ ë°ì´í„° JPA 

ìŠ¤í”„ë§ë¶€íŠ¸ì™€ JPAë§Œ ì‚¬ìš©í•´ë„ ê°œë°œ ìƒì‚°ì„±ì´ ì •ë§ ë§ì´ ì¦ê°€í•˜ê³  ê°œë°œí•´ì•¼ í•  ì½”ë“œë„ í™•ì—°íˆ ì¤„ì–´ë“ ë‹¤. ì—¬ê¸°ì„œ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ë©´, ê¸°ì¡´ì˜ í•œê³„ë¥¼ ë„˜ì–´ ë§ˆì¹˜ ë§ˆë²•ì²˜ëŸ¼, **ë ˆí¼ì§€í† ë¦¬ì— êµ¬í˜„ í´ë˜ìŠ¤ ì—†ì´ ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ ê°œë°œì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.** ê·¸ë¦¬ê³  ë°˜ë³µ ê°œë°œí•´ì˜¨ **ê¸°ë³¸ CRUD ê¸°ëŠ¥ë„ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ ëª¨ë‘ ì œê³µ**í•œë‹¤. 

ìŠ¤í”„ë§ë¶€íŠ¸ì™€ JPAë¼ëŠ” ê¸°ë°˜ ìœ„ì— ìŠ¤í”„ë§ ë°ì´í„° JPAë¼ëŠ” í™˜ìƒì ì¸ í”„ë ˆì„ì›Œí¬ë¥¼ ë”í•˜ë©´ ê°œë°œì´ ì¦ê±°ì›Œì§„ë‹¤. ì§€ê¸ˆê¹Œì§€ ì¡°ê¸ˆì´ë¼ë„ ë‹¨ìˆœí•˜ê³  ë°˜ë³µì´ë¼ ìƒê°í–ˆë‹¤ëŠ” ê°œë°œ ì½”ë“œë“¤ì´ í™•ì—°íˆ ì¤„ì–´ë“ ë‹¤. 

ë”°ë¼ì„œ ê°œë°œìëŠ” í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê°œë°œí•˜ëŠ”ë° ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤. ì‹¤ë¬´ì—ì„œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” ì´ì œ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜â•

â—ï¸ ì£¼ì˜ : **ìŠ¤í”„ë§ ë°ì´í„° JPAëŠ” JPAë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” ê¸°ìˆ **ì´ë‹¤. ë”°ë¼ì„œ JPAë¥¼ ë¨¼ì € í•™ìŠµí•œ í›„ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ í•™ìŠµí•´ì•¼ í•œë‹¤. 

<br>

ì•ì˜ JPA ì„¤ì •ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©

**ìŠ¤í”„ë§ ë°ì´í„° JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬**

**repository/SpringDataJpaMemberRepository.java** ì¸í„°í˜ì´ìŠ¤ ìƒì„± 

```java
package com.example.memberproject.repository;

import com.example.memberproject.domain.Member;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface SpringDataJpaMemberRepository extends JpaRepository<Member, Long>, MemberRepository { // interfaceê°€ interfaceë¥¼ ë°›ì„ ë• implementsê°€ ì•„ë‹ˆë¼ extends

    @Override
    Optional<Member> findByName(String name);
}
```

âœ”ï¸ interfaceê°€ interfaceë¥¼ ë°›ì„ ë• implementsê°€ ì•„ë‹ˆë¼ extends

âœ”ï¸ interfaceëŠ” ë‹¤ì¤‘ìƒì† ê°€ëŠ¥

<br>

**ìŠ¤í”„ë§ ë°ì´í„° JPA íšŒì› ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ë¡ ìŠ¤í”„ë§ ì„¤ì • ë³€ê²½**

**SpringConfig.java**

```java
package com.example.memberproject;

import com.example.memberproject.repository.*;
import com.example.memberproject.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;
import javax.sql.DataSource;

@Configuration
public class SpringConfig {

    private MemberRepository memberRepository;

    @Autowired // ìƒëµ ê°€ëŠ¥
    public SpringConfig(MemberRepository memberRepository) { // ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ MemberRepositoryë¥¼ ì°¾ëŠ”ë‹¤.
        this.memberRepository = memberRepository;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository);
    }

//    @Bean
//    public MemberRepository memberRepository() {
        // return new MemoryMemberRepository();
        // return new JdbcMemberRepository(dataSource);
        // return new JdbcTemplateMemberRepository(dataSource);
        // return new JpaMemberRepository(em);
//    }

}
```

âœ”ï¸ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ SpringDataJpaMemberRepositoryë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡í•´ì¤Œ

í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì
 
 <img width="940" alt="Screen Shot 2022-04-12 at 7 41 34 PM" src="https://user-images.githubusercontent.com/47733530/162942798-51e2ec1d-64d9-4281-88c7-21511ffea354.png">

<br>

**ìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ í´ë˜ìŠ¤**

![image](https://user-images.githubusercontent.com/47733530/162942886-ae042057-ff74-464f-abca-a6c30ecfd65e.png)

â¡ï¸ ìŠ¤í”„ë§ ë°ì´í„° JPAê°€ SpringDataJpaMemberRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³´ê³  ìŠ¤í”„ë§ ë¹ˆì„ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ìŠ¤í”„ë§ ë¹ˆì„ ì˜¬ë¦°ë‹¤. 

â¡ï¸ ê·¸ê±¸ ì¸ì ì…˜ í•´ì„œ ì“´ê²ƒ

â¡ï¸ JpaRepositoryì— ê¸°ë³¸ ê³µí†µ ë©”ì†Œë“œë“¤ì´ ë‹¤ ìˆë‹¤. (save, findById, count, crud....)

â¡ï¸ ëª»ë§Œë“œëŠ” ê±° : findByName ì´ëŸ°ê±°, ê·¼ë° ì¸í„°í˜ì´ìŠ¤ ì´ë¦„ë§Œìœ¼ë¡œë„ ê°œë°œì´ ë (findByName And  Id)

<br>

**ğŸ”µìŠ¤í”„ë§ ë°ì´í„° JPA ì œê³µ ê¸°ëŠ¥ğŸ”µ**

âœ”ï¸ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ê¸°ë³¸ì ì¸ CRUD

âœ”ï¸ findByName(), findByEmail() ì²˜ëŸ¼ ë©”ì„œë“œ ì´ë¦„ ë§Œìœ¼ë¡œ ì¡°íšŒ ê¸°ëŠ¥ ì œê³µ

âœ”ï¸ í˜ì´ì§• ê¸°ëŠ¥ ìë™ ì œê³µ

â• ì°¸ê³  : ì‹¤ë¬´ì—ì„œëŠ” JPAì™€ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ë³µì¡í•œ **ë™ì  ì¿¼ë¦¬ëŠ” Querydsl**ì´ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. Querydslì„ ì‚¬ìš©í•˜ë©´ ì¿¼ë¦¬ë„ ìë°” ì½”ë“œë¡œ ì•ˆì „í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê³ , ë™ì‘ ì¿¼ë¦¬ë„ í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ì´ ì¡°í•©ìœ¼ë¡œ í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ì¿¼ë¦¬ëŠ” JPAê°€ ì œê³µí•˜ëŠ” ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, ì•ì„œ í•™ìŠµí•œ ìŠ¤í”„ë§ JdbcTemplateë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 


## ì •ë¦¬

âœ”ï¸ **ìŠ¤í”„ë§ JdbcTemplate** : ë°˜ë³µë˜ëŠ” ì½”ë“œëŠ” êµ‰ì¥íˆ ì¤„ì–´ë“¤ì§€ë§Œ SQLì€ ì§ì ‘ ì‘ì„±

âœ”ï¸ **JPA** : ê¸°ë³¸ì ì¸ CRUDë¥¼ ì‘ì„±í•˜ëŠ”ë° ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  í•„ìš”ê°€ ì—†ì—ˆìŒ (elect í•  ë•ŒëŠ” JPQLì„ ì§œì•¼í•¨)

âœ”ï¸ **ìŠ¤í”„ë§ ë°ì´í„° JPA** : êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•  í•„ìš”ê°€ ì—†ì´ ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ ê°œë°œì´ ëë‚¨, findByName, findByEmail ë“± ê¸°ë³¸ì ì¸ ë©”ì„œë“œë¥¼ ì œê³µ

## ì°¸ê³ 

> [ìŠ¤í”„ë§ ì…ë¬¸ - ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸, ì›¹ MVC, DB ì ‘ê·¼ ê¸°ìˆ ](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/lecture/49593?tab=curriculum&volume=0.90&mm=close)

> [YoonkyungH.log](https://velog.io/@dbsrud11/Spring-Boot-62-%EC%8A%A4%ED%94%84%EB%A7%81-DB-%EC%A0%91%EA%B7%BC-%EA%B8%B0%EC%88%A0)